# tor_researching

Цель данного аппликейшена - протестировать возможность парсинга вэб-страницы через TOR-сервер.


Возможны 2 варианта парсинга вэб-ресурсов:
1. через прокси-сервера
2. через поднятый локально TOR-сервер

При парсинге через прокси-сервера возможно использовать бесплатные и платные. Вероятность отклика от бесплатного сервера процентов 30%ю
При парсинге через поднятый TOR-сервер 5 риквестов в 1 минуту вероятность получения контента страницы без защииты от роботов - 50%.

В данном коде была использована библиотека для смены IP в случае блокировки контента со стороны отдающего вэб-страницу сервера. По дэфолту установлены параметры для смены IP если 3 блокировки из 5 запросов.
Это число можно поменять в файле index.php.

Результат при запуске index.php раз в 1 минуту по крону при вышеуказаных настройках - 95% получения страницы без каптчи.

Шаги для развертывания:

1. Установить TOR-сервер по руководству https://www.torproject.org/docs/installguide.html.en для необходимой OS
2. генерируем пароль для подключения к локальному TOR-серверу. В консоле набираем
tor --hash-password my_password
Где my_password - желаемый пароль
3. Редактируем файл с настройками TOR-сервера. Открываем файл /etc/tor/torcc.
И раскомментируем строки

...
ControlPort 9051
...
HashedControlPassword ПАРОЛЬ_СГЕНЕРИРОВАННЫЙ_ЧЕРЕЗ_КОНСОЛЬ
CookieAuthentication 0

Обратитеть внимение, что значение CookieAuthentication надо выставить в 0
4. Устанавливаем библиотеку. В консоли набираем composer install
5. Открываем файл index.php b и меняем при необходимости значения констант.
6. В кроне прописываем запуск скрипта через определенный промежуток времени. В консоли набираем crontab -e и вставляем сроку, например, раз в минуту
* * * * * /usr/bin/php {%полный путь к папке с проектом%}/index.php >> {%полный путь к папке с проектом%}/results_with_reload_IP.txt
7. Перезагружаем крон. В консоли набираем sudo service sron reload

Пример сгенерированого файла за сутки работы крона можно посмотреть в папке release.